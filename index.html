<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Course Player</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            background-color: var(--tg-theme-bg-color, #1c1c1d);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        h2 { margin-bottom: 15px; font-size: 18px; text-align: center;}
        
        video {
            width: 95%;
            max-height: 60vh;
            border-radius: 12px;
            background: #000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            outline: none;
        }
        
        .controls {
            margin-top: 25px;
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ */
            gap: 10px;
            width: 90%;
            max-width: 400px;
        }
        
        button {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            opacity: 0.5; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ */
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ —è–∑—ã–∫–∞ */
        button.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(51, 144, 236, 0.4);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        button:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <h2 id="title">–ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–∞...</h2>

    <video id="mainVideo" controls playsinline>
        <source src="" type="video/mp4">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
    </video>

    <div class="controls">
        <button onclick="changeLang('ru')" id="btn-ru">üá∑üá∫ RU</button>
        <button onclick="changeLang('en')" id="btn-en">üá¨üáß EN</button>
        <button onclick="changeLang('zh')" id="btn-zh">üá®üá≥ CN</button>
        <button onclick="changeLang('es')" id="btn-es">üá™üá∏ ES</button>
        <button onclick="changeLang('ar')" id="btn-ar">üá∏üá¶ AR</button>
        <button onclick="changeLang('fr')" id="btn-fr">üá´üá∑ FR</button>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        const tg = window.Telegram.WebApp;
        tg.expand(); 
        tg.ready();

        // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• –í–ò–î–ï–û (–î–†–û–ü–ë–û–ö–°) ---
        const videoDatabase = {
            "1": { // –£—Ä–æ–∫ 1
                "title": "Last War Radar",
                "ru": "https://www.dropbox.com/scl/fi/tiw8ntae3p1ssgez6nd5l/.mp4?rlkey=ca00xxur89xm6tascgutp20ek&st=7sf8nj6e&raw=1",
                "en": "https://www.dropbox.com/scl/fi/myothlxdqlzdugoxougz1/video_en.mp4?rlkey=26u1y9fd25hz5poz2cfj3cb5i&st=lo3ustpc&raw=1",
                "zh": "https://www.dropbox.com/scl/fi/bmygahd2zs2czm6c3tued/video_zh.mp4?rlkey=2ur9msttc4zrg2i3r18bygn58&st=5705nucc&raw=1",
                "es": "https://www.dropbox.com/scl/fi/s1w3f9d149ow2xm54qnne/video_es.mp4?rlkey=rsy7mlk705w02xc0h9k2kxsbc&st=cds5j2jz&raw=1",
                "ar": "https://www.dropbox.com/scl/fi/11jswagqz75ypk79kegi9/video_ar.mp4?rlkey=ofwlr5izo86x0sjjk9o3jipc4&st=6mxhddx0&raw=1",
                "fr": "https://www.dropbox.com/scl/fi/za8ft7tavwojgt6cotwyt/video_fr.mp4?rlkey=c4nfd3e1v2sr7ra7h746m809l&st=pnnykw1h&raw=1"
            }
        };

        // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞ –∏–∑ URL (?lesson=1)
        const urlParams = new URLSearchParams(window.location.search);
        const lessonId = urlParams.get('lesson') || '1'; 
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∞
        const currentLesson = videoDatabase[lessonId];
        const videoElement = document.getElementById('mainVideo');
        
        // –ï—Å–ª–∏ —É—Ä–æ–∫ –Ω–∞–π–¥–µ–Ω, —Å—Ç–∞–≤–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        if(currentLesson) {
            document.getElementById('title').innerText = currentLesson.title;
        } else {
            document.getElementById('title').innerText = "–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω";
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
        function changeLang(lang) {
            if (!currentLesson) return;

            const newSrc = currentLesson[lang];
            
            // –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (–º–∞–ª–æ –ª–∏), –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
            if (!newSrc) return;

            // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –∏ —Å—Ç–∞—Ç—É—Å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
            const currentTime = videoElement.currentTime;
            const wasPlaying = !videoElement.paused && !videoElement.ended && videoElement.readyState > 2;

            videoElement.src = newSrc;
            
            // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è
            // –ù–µ–±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç –Ω—É–∂–µ–Ω –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ iOS
            videoElement.onloadedmetadata = function() {
                videoElement.currentTime = currentTime;
                if (wasPlaying) {
                    videoElement.play().catch(e => console.log("Auto-play prevented"));
                }
            };

            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            const activeBtn = document.getElementById(`btn-${lang}`);
            if(activeBtn) activeBtn.classList.add('active');
        }

        // –ó–∞–ø—É—Å–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –†—É—Å—Å–∫–∏–π —è–∑—ã–∫
        changeLang('ru');

    </script>
</body>
</html>
